<div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40">
  <div class="bg-white rounded-lg shadow-2xl p-6 sm:p-6 max-md:w-full w-1/2 border border-gray-200 relative transition-all duration-300">
    <!-- Botón cerrar -->
    <button type="button" (click)="handleCancel()" class="absolute top-3 right-3 text-gray-400 hover:text-red-500 text-2xl font-bold focus:outline-none z-10" aria-label="Cerrar">
      &times;
    </button>
    <!-- Header -->
    <div class="flex items-center justify-between mb-4 sm:mb-6 border-b pb-2 sm:pb-3 bg-gradient-to-r from-blue-50 to-white rounded-t-lg -mx-4 sm:-mx-6 px-4 sm:px-6 pt-2">
      <h2 class="text-xl sm:text-2xl font-bold text-blue-700 flex items-center gap-2">
        <i class="fas fa-user-edit"></i> Editar Perfil
      </h2>
      <div class="text-blue-500 text-xs sm:text-sm font-semibold">Paso {{ currentStep }} de {{ steps.length }}</div>
    </div>
    <!-- Pasos visuales alineados y adaptables, sin línea de fondo -->
    <div class="mb-4 sm:mb-6 w-full overflow-x-auto">
      <div class="flex items-center justify-between min-w-[400px] sm:min-w-0 relative">
        <ng-container *ngFor="let step of steps; let i = index">
          <div class="flex-1 flex flex-col items-center z-10 min-w-[60px]">
            <div
              class="w-8 h-8 rounded-full flex items-center justify-center text-white text-base font-bold border-2 border-blue-200 shadow transition-all duration-200"
              [ngClass]="currentStep >= step.id ? 'bg-blue-600 border-blue-600' : 'bg-gray-300 border-gray-300'"
            >
              <img *ngIf="step.icon" [src]="'assets/icons/' + step.icon" [alt]="step.title" class="w-5 h-5 object-contain" />
              <ng-container *ngIf="!step.icon">{{ step.id }}</ng-container>
            </div>
            <div class="text-[10px] sm:text-xs mt-2 text-center font-medium whitespace-normal break-words max-w-[70px] sm:max-w-[100px]" [ngClass]="currentStep >= step.id ? 'text-blue-600' : 'text-gray-500'">
              {{ step.title }}
            </div>
          </div>
          <div *ngIf="i < steps.length - 1" class="flex-1"></div>
        </ng-container>
      </div>
    </div>
    <!-- Mensajes de éxito y error -->
    <div *ngIf="successMsg" class="mb-4 text-green-700 bg-green-100 border border-green-200 rounded px-4 py-2 text-center font-semibold animate-fade-in">{{ successMsg }}</div>
    <div *ngIf="errorMsg" class="mb-4 text-red-700 bg-red-100 border border-red-200 rounded px-4 py-2 text-center font-semibold animate-fade-in">{{ errorMsg }}</div>
    <!-- Formulario -->
    <form [formGroup]="form" class="mb-4 min-h-[140px]">
      <ng-container [ngSwitch]="currentStep">
        <!-- Paso 1: Información Personal -->
        <div *ngSwitchCase="1" class="space-y-5">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Nombre <span class="text-red-500">*</span></label>
            <input type="text" formControlName="firstName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Nombre" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Apellido <span class="text-red-500">*</span></label>
            <input type="text" formControlName="lastName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Apellido" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Email <span class="text-red-500">*</span></label>
            <input type="email" formControlName="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="ejemplo@correo.com" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Teléfono <span class="text-red-500">*</span></label>
            <input type="text" formControlName="phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Teléfono" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Fecha de Nacimiento <span class="text-red-500">*</span></label>
            <input type="date" formControlName="birthDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Género <span class="text-red-500">*</span></label>
            <select formControlName="gender" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base">
              <option value="">Seleccionar</option>
              <option value="male">Masculino</option>
              <option value="female">Femenino</option>
            </select>
          </div>
        </div>
        <!-- Paso 2: Información Física -->
        <div *ngSwitchCase="2" class="space-y-5">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Altura (cm) <span class="text-red-500">*</span></label>
            <input type="number" min="100" max="250" formControlName="height" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="170" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Peso (kg) <span class="text-red-500">*</span></label>
            <input type="number" min="30" max="300" formControlName="weight" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="70" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Color de Cabello <span class="text-red-500">*</span></label>
            <input type="text" formControlName="hairColor" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Ej: Brown" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Tipo de Cabello <span class="text-red-500">*</span></label>
            <input type="text" formControlName="hairType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Ej: Curly" />
          </div>
        </div>
        <!-- Paso 3: Información Profesional (universidad, empresa) -->
        <div *ngSwitchCase="3" class="space-y-5">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Universidad</label>
            <input type="text" formControlName="university" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Universidad" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Empresa <span class="text-red-500">*</span></label>
            <input type="text" formControlName="company" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Empresa" />
          </div>
        </div>
        <!-- Paso 4: Dirección de la Empresa y datos laborales -->
        <div *ngSwitchCase="4" class="space-y-5">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Departamento <span class="text-red-500">*</span></label>
            <input type="text" formControlName="department" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Departamento" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Título <span class="text-red-500">*</span></label>
            <input type="text" formControlName="title" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Título" />
          </div>
          <div class="border-t pt-4">
            <label class="block text-sm font-semibold text-gray-700 mb-1">Dirección de la Empresa <span class="text-red-500">*</span></label>
            <input type="text" formControlName="companyAddress" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Calle y número" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Ciudad Empresa <span class="text-red-500">*</span></label>
            <input type="text" formControlName="companyCity" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Ciudad" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Estado Empresa <span class="text-red-500">*</span></label>
            <input type="text" formControlName="companyState" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Estado" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Código Estado Empresa <span class="text-red-500">*</span></label>
            <input type="text" formControlName="companyStateCode" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Ej: CA, TX" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Código Postal Empresa <span class="text-red-500">*</span></label>
            <input type="text" formControlName="companyPostalCode" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="12345" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">País Empresa <span class="text-red-500">*</span></label>
            <input type="text" formControlName="companyCountry" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="País" />
          </div>
        </div>
        <!-- Paso 5: Dirección Personal -->
        <div *ngSwitchCase="5" class="space-y-5">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Dirección <span class="text-red-500">*</span></label>
            <input type="text" formControlName="address" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Calle y número" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Ciudad <span class="text-red-500">*</span></label>
            <input type="text" formControlName="city" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Ciudad" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Estado <span class="text-red-500">*</span></label>
            <input type="text" formControlName="state" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Estado" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Código de Estado <span class="text-red-500">*</span></label>
            <input type="text" formControlName="stateCode" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Ej: CA, TX" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Código Postal <span class="text-red-500">*</span></label>
            <input type="text" formControlName="postalCode" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="12345" />
          </div>
        </div>
        <!-- Paso 6: Información Bancaria -->
        <div *ngSwitchCase="6" class="space-y-5">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Número de Tarjeta <span class="text-red-500">*</span></label>
            <input type="text" formControlName="cardNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="1234 5678 9012 3456" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Fecha de Expiración <span class="text-red-500">*</span></label>
            <input type="text" formControlName="cardExpire" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="MM/YY" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Tipo de Tarjeta <span class="text-red-500">*</span></label>
            <input type="text" formControlName="cardType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Visa, Mastercard..." />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Moneda <span class="text-red-500">*</span></label>
            <input type="text" formControlName="currency" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="USD, EUR..." />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">IBAN <span class="text-red-500">*</span></label>
            <input type="text" formControlName="iban" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="IBAN" />
          </div>
        </div>
        <!-- Paso 7: Información Técnica -->
        <div *ngSwitchCase="7" class="space-y-5">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Dirección IP</label>
            <input type="text" formControlName="ip" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="192.168.1.1" />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">MAC</label>
            <input type="text" formControlName="macAddress" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="00:1B:44:11:3A:B7" />
          </div>
        </div>
        <!-- Paso 8: Cripto -->
        <div *ngSwitchCase="8" class="space-y-5">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Criptomoneda <span class="text-red-500">*</span></label>
            <input type="text" formControlName="cryptoCoin" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Bitcoin, Ethereum..." />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Wallet <span class="text-red-500">*</span></label>
            <input type="text" formControlName="cryptoWallet" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="0x..." />
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Network <span class="text-red-500">*</span></label>
            <input type="text" formControlName="cryptoNetwork" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="Ej: ERC-20, BEP-20" />
          </div>
        </div>
      </ng-container>
    </form>
    <!-- Botones -->
    <div class="flex justify-between mt-6">
      <button type="button" (click)="prevStep()" [disabled]="currentStep === 1" class="flex items-center px-5 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:text-gray-400 disabled:border-gray-200 disabled:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-base font-semibold">
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Anterior
      </button>
      <div class="flex space-x-3">
        <button type="button" (click)="handleCancel()" class="px-5 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-base font-semibold">
          Cancelar
        </button>
        <button *ngIf="currentStep < steps.length" type="button" (click)="nextStep()" class="flex items-center px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-base font-semibold">
          Siguiente
          <svg class="w-5 h-5 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
        <button *ngIf="currentStep === steps.length" type="button" (click)="handleSave()" class="px-5 py-2 bg-stone-700 text-white rounded-lg hover:bg-stone-800 transition-colors text-base font-semibold">
          Guardar Perfil
        </button>
      </div>
    </div>
  </div>
</div>
