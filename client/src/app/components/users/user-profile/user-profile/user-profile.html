<div class="space-y-8 relative">
  <!-- Modal Wizard -->
  <div *ngIf="isEditing" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60">
    <div class="w-full max-w-3xl bg-white rounded-2xl shadow-2xl p-0 md:p-8 relative animate-fade-in">
      <app-profile-wizard-expanded
        [user]="user"
        (onSave)="handleProfileUpdate($event)"
        (onCancel)="handleCancel()"
      ></app-profile-wizard-expanded>
    </div>
  </div>

  <!-- Perfil principal y tabs (deshabilitados visualmente si isEditing) -->
  <div [class.opacity-30]="isEditing" [class.pointer-events-none]="isEditing">
    <!-- Perfil principal -->
    <div class="bg-white rounded-2xl shadow-xl p-8 flex flex-col md:flex-row items-center md:items-start gap-8">
      <img
        [src]="user?.image || '/placeholder.svg?height=120&width=120'"
        [alt]="user?.firstName + ' ' + user?.lastName"
        class="w-32 h-32 rounded-full object-cover ring-4 ring-blue-100 shadow"
      />
      <div class="flex-1 space-y-2">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2">
          <div>
            <h2 class="text-3xl font-bold text-gray-900 flex items-center gap-2">
              {{ user?.firstName }} {{ user?.lastName }}
              <span *ngIf="status === 'active'" class="ml-2 px-3 py-1 rounded-full bg-green-100 text-green-700 text-xs font-bold flex items-center gap-1">
                <i class="fas fa-check-circle"></i> Activo
              </span>
              <span *ngIf="status === 'inactive'" class="ml-2 px-3 py-1 rounded-full bg-red-100 text-red-700 text-xs font-bold flex items-center gap-1">
                <i class="fas fa-times-circle"></i> Inactivo
              </span>
            </h2>
            <div class="flex items-center gap-3 mt-1 text-gray-500">
              <i class="fas fa-envelope"></i> <span>{{ user?.email }}</span>
              <i class="fas fa-phone-alt ml-4"></i> <span>{{ user?.phone }}</span>
            </div>
          </div>
          <button
            (click)="isEditing = true"
            class="mt-4 md:mt-0 bg-blue-600 text-white px-6 py-2 rounded-lg shadow hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2"
          >
            <i class="fas fa-edit"></i> Editar Perfil
          </button>
        </div>
        <div class="flex items-center gap-4 mt-2">
          <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 shadow">
            <i class="fas fa-tasks mr-1"></i> Perfil completado: {{ percentComplete }}%
          </span>
          <span class="text-xs text-gray-400">ID: {{ user?.id }}</span>
        </div>
      </div>
    </div>

    <!-- Tabs de navegación -->
    <div class="w-full border-b border-gray-200">
      <nav class="flex space-x-8 px-2 md:px-8">
        <button
          (click)="activeSection = 'personal'"
          class="py-3 px-1 border-b-2 font-semibold text-base transition-colors"
          [ngClass]="activeSection === 'personal' ? 'border-blue-600 text-blue-700' : 'border-transparent text-gray-500 hover:text-blue-600 hover:border-blue-200'"
        >
          <i class="fas fa-user mr-1"></i> Personal
        </button>
        <button
          (click)="activeSection = 'professional'"
          class="py-3 px-1 border-b-2 font-semibold text-base transition-colors"
          [ngClass]="activeSection === 'professional' ? 'border-blue-600 text-blue-700' : 'border-transparent text-gray-500 hover:text-blue-600 hover:border-blue-200'"
        >
          <i class="fas fa-briefcase mr-1"></i> Profesional
        </button>
        <button
          (click)="activeSection = 'location'"
          class="py-3 px-1 border-b-2 font-semibold text-base transition-colors"
          [ngClass]="activeSection === 'location' ? 'border-blue-600 text-blue-700' : 'border-transparent text-gray-500 hover:text-blue-600 hover:border-blue-200'"
        >
          <i class="fas fa-map-marker-alt mr-1"></i> Ubicación
        </button>
      </nav>
    </div>

    <!-- Secciones -->
    <div class="p-4 md:p-8 bg-white rounded-2xl shadow space-y-8">
      <!-- Personal -->
      <div *ngIf="activeSection === 'personal'" class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="space-y-4">
          <h3 class="text-lg font-bold text-blue-700 mb-2">Datos Básicos</h3>
          <div><span class="font-medium">Nacimiento:</span> {{ user?.birthDate || 'No especificado' }}</div>
          <div><span class="font-medium">Género:</span> {{ user?.gender || 'No especificado' }}</div>
          <div><span class="font-medium">Edad:</span> {{ user?.age || 'No especificado' }} años</div>
          <div><span class="font-medium">Tipo de Sangre:</span> {{ user?.bloodGroup || 'No especificado' }}</div>
        </div>
        <div class="space-y-4">
          <h3 class="text-lg font-bold text-blue-700 mb-2">Datos Físicos</h3>
          <div><span class="font-medium">Altura:</span> {{ user?.height || 'No especificado' }} cm</div>
          <div><span class="font-medium">Peso:</span> {{ user?.weight || 'No especificado' }} kg</div>
          <div><span class="font-medium">Ojos:</span> {{ user?.eyeColor || 'No especificado' }}</div>
          <div><span class="font-medium">Cabello:</span> {{ user?.hair?.color || 'No especificado' }}</div>
        </div>
      </div>
      <!-- Profesional -->
      <div *ngIf="activeSection === 'professional'" class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="space-y-4">
          <h3 class="text-lg font-bold text-blue-700 mb-2">Académico</h3>
          <div><span class="font-medium">Universidad:</span> {{ user?.university || 'No especificado' }}</div>
        </div>
        <div class="space-y-4">
          <h3 class="text-lg font-bold text-blue-700 mb-2">Laboral</h3>
          <div><span class="font-medium">Empresa:</span> {{ user?.company?.name || 'No especificado' }}</div>
          <div><span class="font-medium">Departamento:</span> {{ user?.company?.department || 'No especificado' }}</div>
          <div><span class="font-medium">Título:</span> {{ user?.company?.title || 'No especificado' }}</div>
        </div>
      </div>
      <!-- Ubicación -->
      <div *ngIf="activeSection === 'location'" class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="space-y-4">
          <h3 class="text-lg font-bold text-blue-700 mb-2">Dirección</h3>
          <div><span class="font-medium">Dirección:</span> {{ user?.address?.address || 'No especificado' }}</div>
          <div><span class="font-medium">Ciudad:</span> {{ user?.address?.city || 'No especificado' }}</div>
          <div><span class="font-medium">Estado:</span> {{ user?.address?.state || 'No especificado' }}</div>
          <div><span class="font-medium">País:</span> {{ user?.address?.country || 'No especificado' }}</div>
          <div><span class="font-medium">CP:</span> {{ user?.address?.postalCode || 'No especificado' }}</div>
          <div><span class="font-medium">MAC:</span> {{ user?.macAddress || 'No especificado' }}</div>
        </div>
        <div class="space-y-4">
          <h3 class="text-lg font-bold text-blue-700 mb-2">Coordenadas GPS</h3>
          <div>
            <span class="font-medium">Latitud:</span> {{ user?.address?.coordinates?.lat || 'No especificado' }}<br>
            <span class="font-medium">Longitud:</span> {{ user?.address?.coordinates?.lng || 'No especificado' }}
          </div>
        </div>
      </div>
    </div>

    <!-- Estadísticas -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
      <div class="bg-blue-50 rounded-xl p-6 text-center shadow">
        <div class="text-3xl font-bold text-blue-600 flex items-center justify-center gap-2">
          <i class="fas fa-tasks"></i> {{ percentComplete }}%
        </div>
        <div class="text-sm text-gray-600 mt-2">Perfil Completado</div>
      </div>
      <div class="bg-green-50 rounded-xl p-6 text-center shadow">
        <div class="text-2xl font-bold text-green-600">
          {{ ('' + (user?.updatedAt ? (user?.updatedAt | date:'shortDate') : (user?.createdAt | date:'shortDate') || ('' + (user ? (user | json) : '')))) }}
        </div>
        <div class="text-sm text-gray-600 mt-2">Última Actualización</div>
      </div>
      <div class="bg-purple-50 rounded-xl p-6 text-center shadow">
        <div *ngIf="status === 'active'" class="text-2xl font-bold text-green-600 flex items-center justify-center gap-2">
          <i class="fas fa-check-circle"></i> Activo
        </div>
        <div *ngIf="status === 'inactive'" class="text-2xl font-bold text-red-600 flex items-center justify-center gap-2">
          <i class="fas fa-times-circle"></i> Inactivo
        </div>
        <div class="text-sm text-gray-600 mt-2">Estado del Perfil</div>
      </div>
    </div>
  </div>
</div>